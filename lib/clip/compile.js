// Generated by CoffeeScript 1.6.2
var Compiler, Parser, compiler;

Parser = require("./parser");

Compiler = (function() {
  /*
  */
  function Compiler() {
    this._parser = new Parser();
  }

  /*
  */


  Compiler.prototype.compile = function(source) {
    var expression, script, scripts, _i, _len, _ref;

    expression = this._parser.parse(source);
    scripts = {};
    if (expression._type === "script") {
      return this._getScript(expression);
    }
    _ref = expression.items;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      script = _ref[_i];
      scripts[script.name] = this._getScript(script.options);
    }
    return scripts;
  };

  /*
  */


  Compiler.prototype._getScript = function(expression, source) {
    var fn;

    fn = new Function("return " + expression);
    fn.expression = expression;
    fn.source = source;
    return fn;
  };

  return Compiler;

})();

compiler = new Compiler();

module.exports = function(script) {
  return compiler.compile(script);
};
