// Generated by CoffeeScript 1.6.2
var Context, Paper, asyngleton, block, element, fragment, modifiers, nodeFactories, pilot, text;

Context = require("./context");

pilot = require("pilot-block");

asyngleton = require("asyngleton");

modifiers = require("./defaultModifiers");

nodeFactories = require("./nodeFactories");

fragment = require("./writers/fragment");

element = require("./writers/element");

text = require("./writers/text");

block = require("./writers/block");

Paper = (function() {
  /*
  */
  function Paper(templateFactory, nodeFactory) {
    this.templateFactory = templateFactory;
    this.nodeFactory = nodeFactory;
    if (!this.nodeFactory) {
      if (typeof window === "undefined") {
        this.nodeFactory = nodeFactories.string;
      } else {
        this.nodeFactory = nodeFactories.dom;
      }
    }
  }

  /*
  */


  Paper.prototype.load = function(context) {
    var writer;

    context.nodeFactory = this.nodeFactory;
    writer = fragment(this.templateFactory(block, element, text, modifiers));
    return writer.load(context);
  };

  /*
  */


  Paper.prototype.bind = function(context) {
    return this.load(context).bind();
  };

  return Paper;

})();

module.exports = function(templateFactory, nodeFactory) {
  return new Paper(templateFactory, nodeFactory);
};

module.exports.Context = Context;

module.exports.registerModifier = function(name, modifier) {
  return modifiers[name] = modifier;
};
