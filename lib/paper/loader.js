// Generated by CoffeeScript 1.6.2
var BindingCollection, BlockWriter, ElementWriter, FragmentWriter, Loader, TextWriter, bindable, modifiers;

modifiers = require("./modifiers");

FragmentWriter = require("./writers/fragment");

BlockWriter = require("./writers/block");

TextWriter = require("./writers/text");

ElementWriter = require("./writers/element");

BindingCollection = require("./bindings/collection");

bindable = require("bindable");

Loader = (function() {
  /*
  */
  Loader.prototype.__isLoader = true;

  /*
  */


  function Loader(template) {
    this.template = template;
    this.nodeFactory = template.nodeFactory;
    this.paper = template.paper;
    this.bindings = new BindingCollection();
    this._writers = {
      fragment: new FragmentWriter(this),
      block: new BlockWriter(this),
      text: new TextWriter(this),
      element: new ElementWriter(this)
    };
  }

  /*
  */


  Loader.prototype.load = function(context) {
    if (context == null) {
      context = {};
    }
    if (!context.__isBindable) {
      context = new bindable.Object(context);
    }
    this.context = context;
    this.node = this.paper(this._writers.fragment.write, this._writers.block.write, this._writers.element.write, this._writers.text.write, modifiers);
    return this;
  };

  /*
  */


  Loader.prototype.bind = function() {
    this.bindings.bind(this.context);
    return this;
  };

  /*
  */


  Loader.prototype.unbind = function() {
    this.bindings.unbind();
    return this;
  };

  /*
  */


  Loader.prototype.toString = function() {
    var div;

    if (this.nodeFactory.name === "string") {
      return this.node.toString();
    }
    if (this.node.nodeType === 11) {
      div = document.createElement("div");
      div.appendChild(this.node.cloneNode(true));
      return div.innerHTML;
    }
  };

  return Loader;

})();

module.exports = Loader;
