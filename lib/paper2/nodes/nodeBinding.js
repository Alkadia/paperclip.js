// Generated by CoffeeScript 1.6.2
var AttributeBinding, Base, ClippedBuffer, NodeBinding, async, attrFactory,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

async = require("async");

ClippedBuffer = require("../../clip/buffer");

Base = require("./base");

attrFactory = require("../decor/attrFactory");

AttributeBinding = (function(_super) {
  __extends(AttributeBinding, _super);

  /*
  */


  function AttributeBinding(name, buffer) {
    this.name = name;
    AttributeBinding.__super__.constructor.call(this);
    this.clippedBuffer = new ClippedBuffer(buffer);
  }

  /*
  */


  AttributeBinding.prototype.load = function(info, callback) {
    this.clippedBuffer.reset(info.data);
    if (this.clippedBuffer.text.length) {
      info.buffer.push(" " + this.name + "=\"" + this.clippedBuffer.text + "\"");
    }
    return callback();
  };

  return AttributeBinding;

})(Base);

NodeBinding = (function(_super) {
  __extends(NodeBinding, _super);

  /*
  */


  NodeBinding.prototype.name = "nodeBinding";

  /*
  */


  function NodeBinding(name, options) {
    this.name = name;
    this.options = options != null ? options : {};
    this.bind = __bind(this.bind, this);
    NodeBinding.__super__.constructor.call(this);
    this.attributes = options.attrs || {};
    this._decor = attrFactory.getDecor(this);
    if (options.children) {
      this.addChild(options.children);
    }
  }

  /*
  */


  NodeBinding.prototype.bind = function() {
    NodeBinding.__super__.bind.call(this);
    return this._decor.bind();
  };

  /*
  */


  NodeBinding.prototype._writeHead = function(context, callback) {
    this._writeStartBlock(context);
    context.buffer.push("<" + this.name);
    return callback();
  };

  /*
  */


  NodeBinding.prototype._loadChildren = function(context, callback) {
    var _this = this;

    return this._decor.load(context, function() {
      context.buffer.push(">");
      return NodeBinding.__super__._loadChildren.call(_this, context, callback);
    });
  };

  /*
  */


  NodeBinding.prototype._writeTail = function(context, callback) {
    context.buffer.push("</" + this.name + ">");
    this._writeEndBlock(context);
    return callback();
  };

  /*
  */


  NodeBinding.prototype.clone = function() {
    return new NodeBinding(this.name, this.options);
  };

  return NodeBinding;

})(require("./bindable"));

module.exports = NodeBinding;
